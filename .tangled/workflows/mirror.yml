when:
  - event: ["push"]
    branch: main
engine: nixery
clone:
  depth: 0
dependencies:
  nixpkgs:
    - git
environment:
  GIT_USER: "fosskar"
steps:
  - name: unshallow
    command: |
      git fetch --unshallow origin
      git fetch --tags origin
  - name: mirror
    command: |
      git push --force --tags "https://${GIT_USER}:${GITHUB_PAT}@github.com/fosskar/nixfiles.git" HEAD:main
      git push --force --tags "https://${GIT_USER}:${GITLAB_PAT}@gitlab.com/fosskar/nixfiles.git" HEAD:main
      git push --force --tags "https://${GIT_USER}:${CODEBERG_TOKEN}@codeberg.org/fosskar/nixfiles.git" HEAD:main
